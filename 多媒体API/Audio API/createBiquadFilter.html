<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web createBiquadFilter API 音频滤波器</title>
    <style>
      body {
        padding: 100px;
      }
      input[type="button"]{
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Web createBiquadFilter API 音频滤波器</h1>
    <hr />

    <audio src="./media/hlbb.mp3" id="origin" controls ></audio>
    <input type="button" onclick="origin.play()" value="原始音质 播放" />
    <input type="button" onclick="origin.pause()" value="原始音源 暂停" />

    <br />

    <audio src="./media/hlbb.mp3" id="audio"></audio>
    <input type="button" onclick="audio.play()" value="滤波音质 播放" />
    <input type="button" onclick="audio.pause()" value="滤波音源 暂停" />

    <label>
      滤波器类型（变声）：<select id="select">
        <option value="lowpass">lowpass - 低通滤波</option>
        <option value="highpass">highpass - 高通滤波</option>
        <option value="bandpass">bandpass - 带通滤波</option>
        <option value="lowshelf">lowshelf - 滤波</option>
        <option value="highshelf">highshelf - 滤波</option>
        <option value="peaking">peaking - 滤波</option>
        <option value="notch">notch - 标准陷波滤波</option>
        <option value="allpass">allpass - 标准二阶全通滤波</option>
      </select>
    </label>
    
    <script>
     let ac = null;
        try {
          ac = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
          alert("请更新至最新版的 Chrome 或者 Firefox");
        }
      {
        const source = ac.createMediaElementSource(audio);

        // 低通滤波节点（高频信号被过滤，听到的声音会很沉闷） // http://web.h3399.cn/BiquadFilterNode.htm
        const filterNode = ac.createBiquadFilter("lowpass");

        source.connect(filterNode);

        filterNode.connect(ac.destination);
        
        console.log('createBiquadFilter 过滤器：', filterNode)

        select.addEventListener("change", function () {
          console.log('createBiquadFilter 过滤器：', filterNode);
          filterNode.type = this.value;
        });
      };

      {
        const audio = document.querySelector('#origin');
        const source = ac.createMediaElementSource(audio);

        const panner = ac.createStereoPanner();
        // panner.pan.value = -1;

        source.connect(panner).connect(ac.destination);
      }
    </script>
  </body>
</html>
